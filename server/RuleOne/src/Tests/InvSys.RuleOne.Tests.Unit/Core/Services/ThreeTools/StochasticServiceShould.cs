using System;
using System.Collections.Generic;
using System.Linq;
using InvSys.RuleOne.Core.Models.ThreeTools;
using InvSys.RuleOne.Core.Services.ThreeTools;
using InvSys.StockQuotes.Api.Client.Proxy.Models;
using Xunit;

namespace InvSys.RuleOne.Tests.Unit.Core.Services.ThreeTools
{
    public class StochasticServiceShould
    {
        [Fact]
        public void CalculateCorrectStochasticData()
        {
            // Arrange
            #region Prices
            var prices = new List<HistoricalQuote>
            {
                new HistoricalQuote{ Date = new DateTime(2013, 4, 22), Open = 1555.25, High = 1565.55, Low = 1548.19, Close = 1562.5},
                new HistoricalQuote{ Date = new DateTime(2013, 4, 23), Open = 1562.5,  High =1579.58, Low = 1562.5, Close =1578.78},
                new HistoricalQuote{ Date = new DateTime(2013, 4, 24), Open = 1578.78, High = 1583, Low = 1575.8, Close = 1578.79},
                new HistoricalQuote{ Date = new DateTime(2013, 4, 25), Open = 1578.93, High = 1592.64, Low = 1578.93, Close =1585.16},
                new HistoricalQuote{ Date = new DateTime(2013, 4, 26), Open = 1585.16, High = 1585.78, Low = 1577.56, Close =1582.24},
                new HistoricalQuote{ Date = new DateTime(2013, 4, 29), Open = 1582.34, High = 1596.65, Low = 1582.34, Close =1593.61},
                new HistoricalQuote{ Date = new DateTime(2013, 4, 30), Open = 1593.58, High = 1597.57, Low = 1586.5, Close =1597.57},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 1 ), Open = 1597.55, High = 1597.55, Low = 1581.28, Close =1582.7},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 2 ), Open = 1582.77, High = 1598.6, Low = 1582.77, Close =1597.59},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 3 ), Open = 1597.6,  High =1618.46, Low = 1597.6, Close =1614.42},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 6 ), Open = 1614.4,  High =1619.77, Low = 1614.21, Close =1617.5},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 7 ), Open = 1617.55, High = 1626.03, Low = 1616.64, Close =1625.96},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 8 ), Open = 1625.95, High = 1632.78, Low = 1622.7, Close =1632.69},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 9 ), Open = 1632.69, High = 1635.01, Low = 1623.09, Close =1626.67},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 10), Open = 1626.69, High = 1633.7, Low = 1623.71, Close =1633.7},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 13), Open = 1632.1,  High =1636, Low = 1626.74, Close =1633.77},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 14), Open = 1633.75, High = 1651.1, Low = 1633.75, Close =1650.34},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 15), Open = 1649.13, High = 1661.49,Low =  1646.68, Close =1658.78},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 16), Open = 1658.07, High = 1660.51,Low =  1648.6, Close =1650.47},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 17), Open = 1652.45, High = 1667.47,Low =  1652.45,Close = 1667.47},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 20), Open = 1665.71, High = 1672.84,Low =  1663.52,Close = 1666.29},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 21), Open = 1666.2,  High =1674.93, Low = 1662.67, Close =1669.16},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 22), Open = 1669.39, High = 1687.18,Low =  1648.86,Close = 1655.35},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 23), Open = 1651.62, High = 1655.5, Low = 1635.53, Close =1650.51},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 24), Open = 1646.67, High = 1649.78, Low = 1636.88,Close = 1649.6},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 28), Open = 1652.63, High = 1674.21, Low = 1652.63,Close = 1660.06},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 29), Open = 1656.57, High = 1656.57, Low = 1640.05,Close = 1648.36},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 30), Open = 1649.14, High = 1661.91, Low = 1648.61,Close = 1654.41},
                new HistoricalQuote{ Date = new DateTime(2013, 5, 31), Open = 1652.13, High = 1658.99, Low = 1630.74,Close = 1630.74},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 3 ), Open = 1631.71, High = 1640.42, Low = 1622.72,Close = 1640.42},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 4 ), Open = 1640.73, High = 1646.53, Low = 1623.62,Close = 1631.38},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 5 ), Open = 1629.05, High = 1629.31, Low = 1607.09,Close = 1608.9},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 6 ), Open = 1609.29, High = 1622.56, Low = 1598.23,Close = 1622.56},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 7 ), Open = 1625.27, High = 1644.4, Low = 1625.27, Close =1643.38},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 10), Open = 1644.67, High = 1648.69, Low = 1639.26,Close = 1642.81},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 11), Open = 1638.64, High = 1640.13, Low = 1622.92,Close = 1626.13},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 12), Open = 1629.94, High = 1637.71, Low = 1610.92,Close = 1612.52},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 13), Open = 1612.15, High = 1639.25, Low = 1608.07,Close = 1636.36},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 14), Open = 1635.52, High = 1640.8, Low = 1623.96, Close =1626.73},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 17), Open = 1630.64, High = 1646.5, Low = 1630.34, Close =1639.04},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 18), Open = 1639.77, High = 1654.19, Low = 1639.77,Close = 1651.81},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 19), Open = 1651.83, High = 1652.45, Low = 1628.91,Close = 1628.93},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 20), Open = 1624.62, High = 1624.62, Low = 1584.32,Close = 1588.19},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 21), Open = 1588.62, High = 1599.19, Low = 1577.7, Close =1592.43},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 24), Open = 1588.77, High = 1588.77, Low = 1560.33,Close = 1573.09},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 25), Open = 1577.52, High = 1593.79, Low = 1577.09,Close = 1588.03},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 26), Open = 1592.27, High = 1606.83, Low = 1592.27,Close = 1603.26},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 27), Open = 1606.44, High = 1620.07, Low = 1606.44,Close = 1613.2},
                new HistoricalQuote{ Date = new DateTime(2013, 6, 28), Open = 1611.12, High = 1615.94, Low = 1601.06,Close = 1606.28},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 1 ), Open = 1609.78, High = 1626.61, Low = 1609.78,Close = 1614.96},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 2 ), Open = 1614.29, High = 1624.26, Low = 1606.77,Close = 1614.08},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 3 ), Open = 1611.48, High = 1618.97, Low = 1604.57,Close = 1615.41},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 5 ), Open = 1618.65, High = 1632.07, Low = 1614.71,Close = 1631.89},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 8 ), Open = 1634.2,  High =1644.68, Low = 1634.2, Close =1640.46},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 9 ), Open = 1642.89, High = 1654.18, Low = 1642.89, Close =1652.32},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 10), Open = 1651.56, High = 1657.92, Low = 1647.66, Close =1652.62},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 11), Open = 1657.41, High = 1676.63, Low = 1657.41, Close =1675.02},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 12), Open = 1675.26, High = 1680.19, Low = 1672.33, Close =1680.19},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 15), Open = 1679.59, High = 1684.51, Low = 1677.89, Close =1682.5},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 16), Open = 1682.7,  High =1683.73, Low = 1671.84, Close =1676.26},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 17), Open = 1677.91, High = 1684.75, Low = 1677.91,Close = 1680.91},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 18), Open = 1681.05, High = 1693.12, Low = 1681.05,Close = 1689.37},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 19), Open = 1686.15, High = 1692.09, Low = 1684.08,Close = 1692.09},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 22), Open = 1694.41, High = 1697.61, Low = 1690.67,Close = 1695.53},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 23), Open = 1696.63, High = 1698.78, Low = 1691.13,Close = 1692.39},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 24), Open = 1696.06, High = 1698.38, Low = 1682.57,Close = 1685.94},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 25), Open = 1685.21, High = 1690.94, Low = 1680.07,Close = 1690.25},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 26), Open = 1687.31, High = 1691.85, Low = 1676.03,Close = 1691.65},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 29), Open = 1690.32, High = 1690.92, Low = 1681.86,Close = 1685.33},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 30), Open = 1687.92, High = 1693.19, Low = 1682.42,Close = 1685.96},
                new HistoricalQuote{ Date = new DateTime(2013, 7, 31), Open = 1687.76, High = 1698.43, Low = 1684.94,Close = 1685.73},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 1 ), Open = 1689.42, High = 1707.85, Low = 1689.42,Close = 1706.87},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 2 ), Open = 1706.1,  High =1709.67, Low = 1700.68, Close =1709.67},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 5 ), Open = 1708.01, High = 1709.24, Low = 1703.55,Close = 1707.14},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 6 ), Open = 1705.79, High = 1705.79, Low = 1693.29,Close = 1697.37},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 7 ), Open = 1695.3,  High =1695.3, Low = 1684.91, Close =1690.91},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 8 ), Open = 1693.35, High = 1700.18, Low = 1688.38,Close = 1697.48},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 9 ), Open = 1696.1,  High =1699.42, Low = 1686.02, Close =1691.42},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 12), Open = 1688.37, High = 1691.49, Low = 1683.35, Close =1689.47},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 13), Open = 1690.65, High = 1696.81, Low = 1682.62, Close =1694.16},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 14), Open = 1693.88, High = 1695.52, Low = 1684.83, Close =1685.39},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 15), Open = 1679.61, High = 1679.61, Low = 1658.59, Close =1661.32},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 16), Open = 1661.22, High = 1663.6, Low = 1652.61, Close =1655.83},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 19), Open = 1655.25, High = 1659.18, Low = 1645.84,Close = 1646.06},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 20), Open = 1646.81, High = 1658.92, Low = 1646.08,Close = 1652.35},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 21), Open = 1650.66, High = 1656.99, Low = 1639.43,Close = 1642.8},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 22), Open = 1645.03, High = 1659.55, Low = 1645.03,Close = 1656.96},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 23), Open = 1659.92, High = 1664.85, Low = 1654.81,Close = 1663.5},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 26), Open = 1664.29, High = 1669.51, Low = 1656.02,Close = 1656.78},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 27), Open = 1652.54, High = 1652.54, Low = 1629.05,Close = 1630.48},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 28), Open = 1630.25, High = 1641.18, Low = 1627.47,Close = 1634.96},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 29), Open = 1633.5,  High =1646.41, Low = 1630.88, Close =1638.17},
                new HistoricalQuote{ Date = new DateTime(2013, 8, 30), Open = 1638.89, High = 1640.08, Low = 1628.05,Close = 1632.97},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 3 ), Open = 1635.95, High = 1651.35, Low = 1633.41,Close = 1639.77},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 4 ), Open = 1640.72, High = 1655.72, Low = 1637.41,Close = 1653.08},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 5 ), Open = 1653.28, High = 1659.17, Low = 1653.07,Close = 1655.08},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 6 ), Open = 1657.44, High = 1664.83, Low = 1640.62,Close = 1655.17},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 9 ), Open = 1656.85, High = 1672.4, Low = 1656.85, Close =1671.71},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 10), Open = 1675.11, High = 1684.09, Low = 1675.11,Close = 1683.99},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 11), Open = 1681.04, High = 1689.13, Low = 1678.7, Close =1689.13},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 12), Open = 1689.21, High = 1689.97, Low = 1681.96,Close = 1683.42},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 13), Open = 1685.04, High = 1688.73, Low = 1682.22,Close = 1687.99},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 16), Open = 1691.7,  High =1704.95, Low = 1691.7, Close = 1697.6},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 17), Open = 1697.73, High = 1705.52, Low = 1697.73, Close =1704.76},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 18), Open = 1705.74, High = 1729.44, Low = 1700.35, Close =1725.52},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 19), Open = 1727.34, High = 1729.86, Low = 1720.2, Close =1722.34},
                new HistoricalQuote{ Date = new DateTime(2013, 9, 20), Open = 1722.44, High = 1725.23, Low = 1708.89, Close =1709.91}
            };
            #endregion
            IStochasticService stochasticService = new StochasticService();

            // Act
            var calculated = stochasticService.Calculate(prices, 14, 3); // 14, 3 not 14, 5 because test data is for 14, 3

            // Assert
            #region Expected output
            var expected = new List<StochasticData>
            {
                new StochasticData{ Date = new DateTime(2013, 4, 22)},
                new StochasticData{ Date = new DateTime(2013, 4, 23)},
                new StochasticData{ Date = new DateTime(2013, 4, 24)},
                new StochasticData{ Date = new DateTime(2013, 4, 25)},
                new StochasticData{ Date = new DateTime(2013, 4, 26)},
                new StochasticData{ Date = new DateTime(2013, 4, 29)},
                new StochasticData{ Date = new DateTime(2013, 4, 30)},
                new StochasticData{ Date = new DateTime(2013, 5, 1 )},
                new StochasticData{ Date = new DateTime(2013, 5, 2 )},
                new StochasticData{ Date = new DateTime(2013, 5, 3 )},
                new StochasticData{ Date = new DateTime(2013, 5, 6 )},
                new StochasticData{ Date = new DateTime(2013, 5, 7 )},
                new StochasticData{ Date = new DateTime(2013, 5, 8 )},
                new StochasticData{ Date = new DateTime(2013, 5, 9 ), HighestHigh = 1635.01m, LowestLow = 1548.19m, PercentK = 90.39391845m},
                new StochasticData{ Date = new DateTime(2013, 5, 10), HighestHigh = 1635.01m, LowestLow = 1562.5m , PercentK = 98.19335264m},
                new StochasticData{ Date = new DateTime(2013, 5, 13), HighestHigh = 1636m   , LowestLow = 1575.8m , PercentK = 96.29568106m, PercentD =  94.96098405m},
                new StochasticData{ Date = new DateTime(2013, 5, 14), HighestHigh = 1651.1m , LowestLow = 1577.56m, PercentK = 98.96654882m, PercentD =  97.81852751m},
                new StochasticData{ Date = new DateTime(2013, 5, 15), HighestHigh = 1661.49m, LowestLow = 1577.56m, PercentK = 96.77111879m, PercentD =  97.34444956m},
                new StochasticData{ Date = new DateTime(2013, 5, 16), HighestHigh = 1661.49m, LowestLow = 1581.28m, PercentK = 86.26106471m, PercentD =  93.99957744m},
                new StochasticData{ Date = new DateTime(2013, 5, 17), HighestHigh = 1667.47m, LowestLow = 1581.28m, PercentK = 100m        , PercentD =  94.34406116m},
                new StochasticData{ Date = new DateTime(2013, 5, 20), HighestHigh = 1672.84m, LowestLow = 1581.28m, PercentK = 92.84622106m, PercentD =  93.03576192m},
                new StochasticData{ Date = new DateTime(2013, 5, 21), HighestHigh = 1674.93m, LowestLow = 1582.77m, PercentK = 93.73914931m, PercentD =  95.52845679m},
                new StochasticData{ Date = new DateTime(2013, 5, 22), HighestHigh = 1687.18m, LowestLow = 1597.6m , PercentK = 64.46751507m, PercentD =  83.68429514m},
                new StochasticData{ Date = new DateTime(2013, 5, 23), HighestHigh = 1687.18m, LowestLow = 1614.21m, PercentK = 49.74647115m, PercentD =  69.31771184m},
                new StochasticData{ Date = new DateTime(2013, 5, 24), HighestHigh = 1687.18m, LowestLow = 1616.64m, PercentK = 46.72526226m, PercentD =  53.64641616m},
                new StochasticData{ Date = new DateTime(2013, 5, 28), HighestHigh = 1687.18m, LowestLow = 1622.7m , PercentK = 57.94044665m, PercentD =  51.47072669m},
                new StochasticData{ Date = new DateTime(2013, 5, 29), HighestHigh = 1687.18m, LowestLow = 1623.09m, PercentK = 39.42892807m, PercentD =  48.03154566m},
                new StochasticData{ Date = new DateTime(2013, 5, 30), HighestHigh = 1687.18m, LowestLow = 1623.71m, PercentK = 48.36930833m, PercentD =  48.57956102m},
                new StochasticData{ Date = new DateTime(2013, 5, 31), HighestHigh = 1687.18m, LowestLow = 1626.74m, PercentK = 6.618133686m, PercentD =  31.47212336m},
                new StochasticData{ Date = new DateTime(2013, 6, 3 ), HighestHigh = 1687.18m, LowestLow = 1622.72m, PercentK = 27.45888923m, PercentD =  27.48211042m},
                new StochasticData{ Date = new DateTime(2013, 6, 4 ), HighestHigh = 1687.18m, LowestLow = 1622.72m, PercentK = 13.43468818m, PercentD =  15.83723703m},
                new StochasticData{ Date = new DateTime(2013, 6, 5 ), HighestHigh = 1687.18m, LowestLow = 1607.09m, PercentK = 2.259957548m, PercentD =  14.38451165m},
                new StochasticData{ Date = new DateTime(2013, 6, 6 ), HighestHigh = 1687.18m, LowestLow = 1598.23m, PercentK = 27.35244519m, PercentD =  14.34903031m},
                new StochasticData{ Date = new DateTime(2013, 6, 7 ), HighestHigh = 1687.18m, LowestLow = 1598.23m, PercentK = 50.75885329m, PercentD =  26.79041868m},
                new StochasticData{ Date = new DateTime(2013, 6, 10), HighestHigh = 1687.18m, LowestLow = 1598.23m, PercentK = 50.11804384m, PercentD =  42.74311411m},
                new StochasticData{ Date = new DateTime(2013, 6, 11), HighestHigh = 1687.18m, LowestLow = 1598.23m, PercentK = 31.36593592m, PercentD =  44.08094435m},
                new StochasticData{ Date = new DateTime(2013, 6, 12), HighestHigh = 1674.21m, LowestLow = 1598.23m, PercentK = 18.80758094m, PercentD =  33.43052024m},
                new StochasticData{ Date = new DateTime(2013, 6, 13), HighestHigh = 1674.21m, LowestLow = 1598.23m, PercentK = 50.18425902m, PercentD =  33.45259196m},
                new StochasticData{ Date = new DateTime(2013, 6, 14), HighestHigh = 1674.21m, LowestLow = 1598.23m, PercentK = 37.50987102m, PercentD =  35.50057033m},
                new StochasticData{ Date = new DateTime(2013, 6, 17), HighestHigh = 1661.91m, LowestLow = 1598.23m, PercentK = 64.08605528m, PercentD =  50.5933951m },
                new StochasticData{ Date = new DateTime(2013, 6, 18), HighestHigh = 1661.91m, LowestLow = 1598.23m, PercentK = 84.13944724m, PercentD =  61.91179118m},
                new StochasticData{ Date = new DateTime(2013, 6, 19), HighestHigh = 1658.99m, LowestLow = 1598.23m, PercentK = 50.52666228m, PercentD =  66.2507216m },
                new StochasticData{ Date = new DateTime(2013, 6, 20), HighestHigh = 1654.19m, LowestLow = 1584.32m, PercentK = 5.538857879m, PercentD =  46.73498913m},
                new StochasticData{ Date = new DateTime(2013, 6, 21), HighestHigh = 1654.19m, LowestLow = 1577.7m , PercentK = 19.25741927m, PercentD =  25.10764648m},
                new StochasticData{ Date = new DateTime(2013, 6, 24), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 13.59471553m, PercentD =  12.79699756m},
                new StochasticData{ Date = new DateTime(2013, 6, 25), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 29.51203921m, PercentD =  20.788058m  },
                new StochasticData{ Date = new DateTime(2013, 6, 26), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 45.73833369m, PercentD =  29.61502948m},
                new StochasticData{ Date = new DateTime(2013, 6, 27), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 56.32857447m, PercentD =  43.85964912m},
                new StochasticData{ Date = new DateTime(2013, 6, 28), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 48.95589175m, PercentD =  50.3409333m },
                new StochasticData{ Date = new DateTime(2013, 7, 1 ), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 58.20370765m, PercentD =  54.49605796m},
                new StochasticData{ Date = new DateTime(2013, 7, 2 ), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 57.26614106m, PercentD =  54.80858015m},
                new StochasticData{ Date = new DateTime(2013, 7, 3 ), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 58.68314511m, PercentD =  58.05099794m},
                new StochasticData{ Date = new DateTime(2013, 7, 5 ), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 76.24121031m, PercentD =  64.06349883m},
                new StochasticData{ Date = new DateTime(2013, 7, 8 ), HighestHigh = 1654.19m, LowestLow = 1560.33m, PercentK = 85.37183039m, PercentD =  73.43206194m},
                new StochasticData{ Date = new DateTime(2013, 7, 9 ), HighestHigh = 1654.18m, LowestLow = 1560.33m, PercentK = 98.01811401m, PercentD =  86.54371824m},
                new StochasticData{ Date = new DateTime(2013, 7, 10), HighestHigh = 1657.92m, LowestLow = 1560.33m, PercentK = 94.56911569m, PercentD =  92.65302003m},
                new StochasticData{ Date = new DateTime(2013, 7, 11), HighestHigh = 1676.63m, LowestLow = 1560.33m, PercentK = 98.61564918m, PercentD =  97.06762629m},
                new StochasticData{ Date = new DateTime(2013, 7, 12), HighestHigh = 1680.19m, LowestLow = 1560.33m, PercentK = 100m        , PercentD =  97.72825496m},
                new StochasticData{ Date = new DateTime(2013, 7, 15), HighestHigh = 1684.51m, LowestLow = 1577.09m, PercentK = 98.12884007m, PercentD =  98.91482975m},
                new StochasticData{ Date = new DateTime(2013, 7, 16), HighestHigh = 1684.51m, LowestLow = 1592.27m, PercentK = 91.05594102m, PercentD =  96.39492703m},
                new StochasticData{ Date = new DateTime(2013, 7, 17), HighestHigh = 1684.75m, LowestLow = 1601.06m, PercentK = 95.41163819m, PercentD =  94.86547309m},
                new StochasticData{ Date = new DateTime(2013, 7, 18), HighestHigh = 1693.12m, LowestLow = 1601.06m, PercentK = 95.92656963m, PercentD =  94.13138295m},
                new StochasticData{ Date = new DateTime(2013, 7, 19), HighestHigh = 1693.12m, LowestLow = 1604.57m, PercentK = 98.83681536m, PercentD =  96.72500773m},
                new StochasticData{ Date = new DateTime(2013, 7, 22), HighestHigh = 1697.61m, LowestLow = 1604.57m, PercentK = 97.76440241m, PercentD =  97.50926246m},
                new StochasticData{ Date = new DateTime(2013, 7, 23), HighestHigh = 1698.78m, LowestLow = 1604.57m, PercentK = 93.21728054m, PercentD =  96.6061661m },
                new StochasticData{ Date = new DateTime(2013, 7, 24), HighestHigh = 1698.78m, LowestLow = 1614.71m, PercentK = 84.7270132m , PercentD =  91.90289872m},
                new StochasticData{ Date = new DateTime(2013, 7, 25), HighestHigh = 1698.78m, LowestLow = 1634.2m , PercentK = 86.79157634m, PercentD =  88.24529003m},
                new StochasticData{ Date = new DateTime(2013, 7, 26), HighestHigh = 1698.78m, LowestLow = 1642.89m, PercentK = 87.24279835m, PercentD =  86.25379597m},
                new StochasticData{ Date = new DateTime(2013, 7, 29), HighestHigh = 1698.78m, LowestLow = 1647.66m, PercentK = 73.68935837m, PercentD =  82.57457769m},
                new StochasticData{ Date = new DateTime(2013, 7, 30), HighestHigh = 1698.78m, LowestLow = 1657.41m, PercentK = 69.01136089m, PercentD =  76.64783921m},
                new StochasticData{ Date = new DateTime(2013, 7, 31), HighestHigh = 1698.78m, LowestLow = 1671.84m, PercentK = 51.55902004m, PercentD =  64.75324644m},
                new StochasticData{ Date = new DateTime(2013, 8, 1 ), HighestHigh = 1707.85m, LowestLow = 1671.84m, PercentK = 97.27853374m, PercentD =  72.61630489m},
                new StochasticData{ Date = new DateTime(2013, 8, 2 ), HighestHigh = 1709.67m, LowestLow = 1671.84m, PercentK = 100m        , PercentD =  82.94585126m},
                new StochasticData{ Date = new DateTime(2013, 8, 5 ), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 92.47919144m, PercentD =  96.58590839m},
                new StochasticData{ Date = new DateTime(2013, 8, 6 ), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 63.43638526m, PercentD =  85.30519223m},
                new StochasticData{ Date = new DateTime(2013, 8, 7 ), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 44.23305589m, PercentD =  66.71621086m},
                new StochasticData{ Date = new DateTime(2013, 8, 8 ), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 63.76337693m, PercentD =  57.14427269m},
                new StochasticData{ Date = new DateTime(2013, 8, 9 ), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 45.7491082m , PercentD =  51.24851367m},
                new StochasticData{ Date = new DateTime(2013, 8, 12), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 39.95243757m, PercentD =  49.8216409m },
                new StochasticData{ Date = new DateTime(2013, 8, 13), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 53.8941736m , PercentD =  46.53190646m},
                new StochasticData{ Date = new DateTime(2013, 8, 14), HighestHigh = 1709.67m, LowestLow = 1676.03m, PercentK = 27.82401902m, PercentD =  40.55687673m},
                new StochasticData{ Date = new DateTime(2013, 8, 15), HighestHigh = 1709.67m, LowestLow = 1658.59m, PercentK = 5.344557557m, PercentD =  29.02091673m},
                new StochasticData{ Date = new DateTime(2013, 8, 16), HighestHigh = 1709.67m, LowestLow = 1652.61m, PercentK = 5.643182615m, PercentD =  12.93725307m},
                new StochasticData{ Date = new DateTime(2013, 8, 19), HighestHigh = 1709.67m, LowestLow = 1645.84m, PercentK = 0.344665518m, PercentD =  3.777468563m},
                new StochasticData{ Date = new DateTime(2013, 8, 20), HighestHigh = 1709.67m, LowestLow = 1645.84m, PercentK = 10.198966m  , PercentD =  5.395604712m},
                new StochasticData{ Date = new DateTime(2013, 8, 21), HighestHigh = 1709.67m, LowestLow = 1639.43m, PercentK = 4.797835991m, PercentD =  5.113822504m},
                new StochasticData{ Date = new DateTime(2013, 8, 22), HighestHigh = 1709.24m, LowestLow = 1639.43m, PercentK = 25.11101561m, PercentD =  13.36927254m},
                new StochasticData{ Date = new DateTime(2013, 8, 23), HighestHigh = 1705.79m, LowestLow = 1639.43m, PercentK = 36.27185051m, PercentD =  22.06023404m},
                new StochasticData{ Date = new DateTime(2013, 8, 26), HighestHigh = 1700.18m, LowestLow = 1639.43m, PercentK = 28.55967078m, PercentD =  29.98084564m},
                new StochasticData{ Date = new DateTime(2013, 8, 27), HighestHigh = 1700.18m, LowestLow = 1629.05m, PercentK = 2.010403487m, PercentD =  22.28064159m},
                new StochasticData{ Date = new DateTime(2013, 8, 28), HighestHigh = 1699.42m, LowestLow = 1627.47m, PercentK = 10.41000695m, PercentD =  13.66002707m},
                new StochasticData{ Date = new DateTime(2013, 8, 29), HighestHigh = 1696.81m, LowestLow = 1627.47m, PercentK = 15.43120854m, PercentD =  9.283872991m},
                new StochasticData{ Date = new DateTime(2013, 8, 30), HighestHigh = 1696.81m, LowestLow = 1627.47m, PercentK = 7.931929622m, PercentD =  11.25771504m},
                new StochasticData{ Date = new DateTime(2013, 9, 3 ), HighestHigh = 1695.52m, LowestLow = 1627.47m, PercentK = 18.07494489m, PercentD =  13.81269435m},
                new StochasticData{ Date = new DateTime(2013, 9, 4 ), HighestHigh = 1679.61m, LowestLow = 1627.47m, PercentK = 49.11775988m, PercentD =  25.0415448m },
                new StochasticData{ Date = new DateTime(2013, 9, 5 ), HighestHigh = 1669.51m, LowestLow = 1627.47m, PercentK = 65.6755471m , PercentD =  44.28941729m},
                new StochasticData{ Date = new DateTime(2013, 9, 6 ), HighestHigh = 1669.51m, LowestLow = 1627.47m, PercentK = 65.88962892m, PercentD =  60.2276453m },
                new StochasticData{ Date = new DateTime(2013, 9, 9 ), HighestHigh = 1672.4m , LowestLow = 1627.47m, PercentK = 98.46427777m, PercentD =  76.6764846m },
                new StochasticData{ Date = new DateTime(2013, 9, 10), HighestHigh = 1684.09m, LowestLow = 1627.47m, PercentK = 99.82338396m, PercentD =  88.05909688m},
                new StochasticData{ Date = new DateTime(2013, 9, 11), HighestHigh = 1689.13m, LowestLow = 1627.47m, PercentK = 100m        , PercentD =  99.42922058m},
                new StochasticData{ Date = new DateTime(2013, 9, 12), HighestHigh = 1689.97m, LowestLow = 1627.47m, PercentK = 89.52m      , PercentD =  96.44779465m},
                new StochasticData{ Date = new DateTime(2013, 9, 13), HighestHigh = 1689.97m, LowestLow = 1627.47m, PercentK = 96.832m     , PercentD =  95.45066667m},
                new StochasticData{ Date = new DateTime(2013, 9, 16), HighestHigh = 1704.95m, LowestLow = 1627.47m, PercentK = 90.51368095m, PercentD =  92.28856032m},
                new StochasticData{ Date = new DateTime(2013, 9, 17), HighestHigh = 1705.52m, LowestLow = 1627.47m, PercentK = 99.02626521m, PercentD =  95.45731539m},
                new StochasticData{ Date = new DateTime(2013, 9, 18), HighestHigh = 1729.44m, LowestLow = 1628.05m, PercentK = 96.133741m  , PercentD =  95.22456239m},
                new StochasticData{ Date = new DateTime(2013, 9, 19), HighestHigh = 1729.86m, LowestLow = 1628.05m, PercentK = 92.61369217m, PercentD =  95.92456613m},
                new StochasticData{ Date = new DateTime(2013, 9, 20), HighestHigh = 1729.86m, LowestLow = 1633.41m, PercentK = 79.31570762m, PercentD =  89.35438026m}
            };
            #endregion
            var expectedLast = expected.Last();
            var calculatedLast = calculated.Last();
            Assert.Equal(expectedLast.HighestHigh, calculatedLast.HighestHigh);
            Assert.Equal(expectedLast.LowestLow, calculatedLast.LowestLow);
            Assert.Equal(expectedLast.PercentK, calculatedLast.PercentK);
            Assert.Equal(expectedLast.PercentD, calculatedLast.PercentD);

        }
    }
}

